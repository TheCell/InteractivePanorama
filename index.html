<!DOCTYPE html>
<html>
<head>
<title>
	Liftorama
</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style>
	body
	{
		margin: 0px;
		background-color: #AAA;
		overflow: hidden;
	}
</style>
</head>

<body>
<script src="js/three.js"></script>
<script src="js/OBJLoader.js"></script>

<script>
"use strict";

let ambientLight, pointLight;
let userCamera;
let elevatorScene;
let elevatorRenderer;
let panoTopObj;
let panoBottomObj;
let moveX,moveY,moveZ;
let moveSpeedX,moveSpeedY,moveSpeedZ;
let posXValue, posYValue, posZValue;
let moveXMinus, moveYMinus, moveZMinus;
let enableTurn = false;
let turnX = 0.00;
let turnY = -1.5;
let turnZ = 0.00;
let panoXTurn = 0.00;
const X_AXIS_VECTOR =  new THREE.Vector3( 1, 0, 0 );

let raycaster;
let mouse;
let objects = []; // all objects that are interactable;
let panoramaTextureArray = [];
let pano1Material;
let pano2Material;
let plankMaterial;
let wallMaterial;
let elevatorMaterial;
let debugMode = true;
let panoTopTextureIndex;
let panoBottomTextureIndex;

init();

function init()
{
	//Perspektivische Kammera wird erstellt
	userCamera = new THREE.PerspectiveCamera( 80, window.innerWidth / window.innerHeight, 1, 1000 );
	userCamera.position.z = 2;
	userCamera.position.y = 0;
	userCamera.position.x = -20;

	// Scene erstellen
	elevatorScene = new THREE.Scene();
	// Hintergrund Farbe wird gesetzt
	var backgroundColor = new THREE.Color(0xFF8822);
	elevatorScene.background = backgroundColor;

	// add Lightsources
	ambientLight = new THREE.AmbientLight( 0x505050 , 1.0);
	elevatorScene.add(ambientLight);
	pointLight = new THREE.PointLight( 0xFFFFFF, 1.0, 0.0, 1.0);
	pointLight.position.set(-300, 100, 200);
	elevatorScene.add(pointLight);

	loadPanoramas();
	setupMaterials();

	// load the complete Scene
	var objFile = "objects/SceneAufzug.obj";
	var loader = new THREE.OBJLoader();
	loader.load( objFile, function( object )
	{
		object.scale.set(1, 1, 1);
		object.children[0].material = pano1Material;
		object.children.forEach( function (obj, index)
		{
			if (obj.name == "zylinderUnten")
			{
				obj.material = pano1Material;
				panoTopObj = obj;
				//obj.scale.set(1, 0.33, 1);
			}
			else if (obj.name == "zylinderOben")
			{
				obj.material = pano2Material;
				panoBottomObj = obj;
				//obj.scale.set(1, 0.33, 1);
			}
			else if (obj.name == "Wand")
			{
				obj.material = wallMaterial;
			}
			else if (obj.name == "Aufzug")
			{
				obj.material = elevatorMaterial;
			}
			else if (obj.name == "AufzugHolz")
			{
				obj.material = plankMaterial;
			}
			else if (obj.name == "AufzugHolz2")
			{
				obj.material = plankMaterial;
			}

			objects.push( obj );
		});

		elevatorScene.add( object );
	} );

	// setup renderer
	elevatorRenderer = new THREE.WebGLRenderer( {antialias: true} );
	elevatorRenderer.setPixelRatio( window.devicePixelRatio );
	elevatorRenderer.setSize( window.innerWidth, window.innerHeight );
	document.body.appendChild( elevatorRenderer.domElement );

	moveX = false;
	moveY = false;
	moveZ = false;
	moveXMinus = false;
	moveYMinus = false;
	moveZMinus = false;
	moveSpeedX = 1;
	moveSpeedY = 1;
	moveSpeedZ = 1;
	posXValue = 0;
	posYValue = 0;
	posZValue = 0;

	window.addEventListener( 'resize', onWindowResize, false );
	window.addEventListener( 'keydown', onKeyPressed, false );
	window.addEventListener( 'keyup', onKeyUp, false );
	window.addEventListener( 'mouseup',   onMouseUp, false );
	window.addEventListener( 'mousemove', onMouseMove, false );
	window.addEventListener( 'mousedown', onMouseDown, false );
	window.addEventListener( 'mouseup', onMouseUp, false );

	animate();
}

function loadPanoramas()
{
	// Load all Panoramas
	if (debugMode)
	{
		console.log("loading All Panoramas");
	}
	panoramaTextureArray[0] = new THREE.TextureLoader().load( 'img/singleshot.png' );
	panoramaTextureArray[1] = new THREE.TextureLoader().load( 'img/BallSackDogPano.png' );
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/panorama-atelier-web.png' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/pano4Edit.png' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-1-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-1-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-1-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-1-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-2-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-2-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-2-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-2-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-3-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-3-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-3-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-3-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-4-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-4-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-4-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-4-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-5-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-5-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-5-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-5-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-6-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-6-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-6-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-6-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-7-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-7-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-7-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-7-4.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-8-1.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-8-2.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-8-3.gif' ));
	panoramaTextureArray.push(new THREE.TextureLoader().load( 'img/mario-8-4.gif' ));

	panoramaTextureArray.forEach( function (element, index)
	{
		// horizontal und vertical Texturemapping, Die Textur wird unendlich offt wiederholt
		panoramaTextureArray[index].wrapS = THREE.RepeatWrapping;
		panoramaTextureArray[index].wrapT = THREE.RepeatWrapping;
	});
	if (debugMode)
	{
		console.log("loading All Panoramas finished");
	}
}

function setupMaterials()
{
	// setup both Panorama Materials
	pano1Material = new THREE.MeshBasicMaterial(
		{
			map: panoramaTextureArray[0]
		}
	);
	panoTopTextureIndex = 0;
	pano1Material.shading = THREE.SmoothShading;
	//definiert welche Seite gerendert werden soll. Front,Back,Double
	pano1Material.side = THREE.DoubleSide;

	pano2Material = new THREE.MeshBasicMaterial(
		{
			map: panoramaTextureArray[1]
		}
	);
	panoBottomTextureIndex = 1;
	pano2Material.shading = THREE.SmoothShading;
	//definiert welche Seite gerendert werden soll. Front,Back,Double
	pano2Material.side = THREE.DoubleSide;

	let texturePlank = new THREE.TextureLoader().load( 'img/Textures/woodenPlanksAll.png' );
	texturePlank.wrapS = texturePlank.wrapT = THREE.RepeatWrapping;
	plankMaterial = new THREE.MeshBasicMaterial( { map: texturePlank } );
	plankMaterial.shading = THREE.SmoothShading;
	plankMaterial.side = THREE.DoubleSide;

	let textureWall = new THREE.TextureLoader().load( 'img/Textures/wand.png' );
	textureWall.wrapS = textureWall.wrapT = THREE.RepeatWrapping;
	wallMaterial = new THREE.MeshBasicMaterial( { map: textureWall } );
	wallMaterial.shading = THREE.SmoothShading;
	wallMaterial.side = THREE.DoubleSide;

	let textureElevator = new THREE.TextureLoader().load( 'img/Textures/aufzug.png' );
	textureElevator.wrapS = textureElevator.wrapT = THREE.RepeatWrapping;
	elevatorMaterial = new THREE.MeshBasicMaterial( { map: textureElevator } );
	elevatorMaterial.shading = THREE.SmoothShading;
	elevatorMaterial.side = THREE.DoubleSide;
}

function onWindowResize()
{
	userCamera.aspect = window.innerWidth / window.innerHeight;
	userCamera.updateProjectionMatrix();
	elevatorRenderer.setSize( window.innerWidth, window.innerHeight );
}

function onKeyPressed(event)
{
	switch(event.keyCode)
	{
		case 87://W
			moveX = true;
		break;
		case 65://A
			moveZMinus = true;
		break;
		case 83://S
			moveXMinus = true;
		break;
		case 68://D
			moveZ = true;
		break;
		case 32://space
			moveY = true;
		break;
		case 16://shiftleft
			moveYMinus = true;
		break;
	}
}

function onKeyUp(event)
{
	switch(event.keyCode)
	{
		case 87://W
			moveX = false;
		break;
		case 65://A
			moveZMinus = false;
		break;
		case 83://S
			moveXMinus = false;
		break;
		case 68://D
			moveZ = false;
		break;
		case 32://space
			moveY = false;
		break;
		case 16://shiftleft
			moveYMinus = false;
		break;
	}
}

function animate()
{
	requestAnimationFrame( animate );
	elevatorRenderer.render( elevatorScene, userCamera );

	if(moveX)
	{
		posXValue += moveSpeedX;
	}
	if(moveY)
	{
		posYValue += moveSpeedY;
	}
	if(moveZ)
	{
		posZValue += moveSpeedZ;
	}
	if(moveXMinus)
	{
		posXValue -= moveSpeedX;
	}
	if(moveYMinus)
	{
		posYValue -= moveSpeedY;
	}
	if(moveZMinus)
	{
		posZValue -= moveSpeedZ;
	}

	userCamera.rotation.x = turnX;
	userCamera.rotation.y = turnY;
	userCamera.rotation.z = turnZ;

	userCamera.position.x = posXValue;
	userCamera.position.y = posYValue;
	userCamera.position.z = posZValue;

	objects.forEach( function (object, index)
	{
		if (object.name == "zylinderOben" || object.name == "zylinderUnten")
		{
			object.translateOnAxis(X_AXIS_VECTOR,-235);
			object.rotation.y = panoXTurn
			object.translateOnAxis(X_AXIS_VECTOR,235);
		}
	});
}

function onMouseMove( event )
{
	var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
	var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

	if (enableTurn == false)
	{
		// yes they are inverted and this needs to be
		//turnZ += movementY * -0.002;
		//turnY += movementX * -0.002;
	}
	else
	{
		panoXTurn += movementX * -0.01;
	}
}

function onMouseDown( event ) { enableTurn = true; }
function onMouseUp  ( event ) { enableTurn = false; }

function loadTexture( glTexture, isPanoTop = true )
{
	if ( isPanoTop )
	{
		changeTexture( panoTopObj.material, glTexture );
	}
	else
	{
		changeTexture( panoBottomObj.material, glTexture );
	}
}

function changeTexture ( glMaterial, glTexture )
{
	glMaterial.map = glTexture;
}

/*
var customMaterial = new THREE.ShaderMaterial(
{

	uniforms:
	{

		time: { value: 1.0 },
		resolution: { value: new THREE.Vector2() }

	},

	vertexShader: document.getElementById( 'customMaterialVertexShader' ).textContent,
	fragmentShader: document.getElementById( 'customMaterialFragmentShader' ).textContent
} );
*/
</script>
</body>
</html>